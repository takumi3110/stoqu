{% extends 'base.html' %}
{% load django_bootstrap5 %}
{% load static %}
{% load humanize %}
{% load extras %}


{% block content %}

    <div class="container my-5">
        <div class="row mb-3">
            <h2 class="title-text">在庫リスト</h2>
        </div>
        <section class="row mt-5">
            <div class="form-group col-2">
            <label>在庫拠点：</label>
            <select title="base" name="base" class="custom-select" id="baseSelect">
                <option value="all">すべて</option>
                {% for base in base_list %}
                    <option value="{{ base.name }}">{{ base.name }}</option>
                {% endfor %}
            </select>
            </div>
            <div class="form-group col-3">
            <label>カテゴリー：</label>
            <select title="category" name="category" class="custom-select" id="categorySelect">
                <option value="all">すべて</option>
                <option value="ノートPC">ノートPC</option>
                <option value="デスクトップPC">デスクトップPC</option>
                <option value="ミニPC">ミニPC</option>
            </select>
            </div>
        </section>
        <section class="row" id="storageTable">
            <div class="storage-table">
                <table class="table table-bordered table-sm table-hover mt-5">
                    <thead class="table-light">
                        <tr>
                            <th>発注番号</th>
                            <th>カテゴリー</th>
                            <th>メーカー</th>
                            <th>モデル名</th>
                            <th>CPU</th>
                            <th>メモリ</th>
                            <th>ストレージ</th>
                            <th>テンキー</th>
                            <th>在庫数</th>
                            <th>金額</th>
                            <th>在庫拠点</th>
                            <th>詳細</th>
                        </tr>
                    </thead>
                    <tbody>
                    {% for storageitem in storageitem_list %}
                        <tr id="table{{ storageitem.pk }}" class="storage-item">
                            <td>{{ storageitem.order_number }}</td>
                            <td id="category{{ storageitem.pk }}">{{ storageitem.item.pc.get_category_display }}</td>
                            <td>{{ storageitem.item.pc.maker }}</td>
                            <td>{{ storageitem.item.pc.name }}</td>
                            <td>{{ storageitem.item.cpu }}</td>
                            <td>{{ storageitem.item.memory }}GB</td>
                            <td>{{ storageitem.item.storage }}</td>
                            <td>
	                            <label for="tableNumpad" style="display: none;"></label>
	                            <input class="form-check-input" type="checkbox" id="tableNumpad" aria-label="{{ storageitem.item.pc.name }}"
	                                   {% if storageitem.item.numpad %}checked{% endif %}  disabled>
                            </td>
                            <td>{{ storageitem.quantity }}</td>
                            <td>{{ storageitem.total_price | intcomma }}</td>
                            <td id="base{{ storageitem.pk }}">{{ storageitem.base }}</td>
                            <td>
                                <a href="{% url 'stock:storage_detail'  storageitem.pk %}">詳細</a>
                            </td>
                        </tr>
                    {% empty %}
                        <tr>
                            <td colspan="11">在庫PCないです</td>
                        </tr>
                    {% endfor %}
                        <tr id="nonStorage" style="display: none;">
                            <td colspan="11">在庫ないです</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>
        <div class="row mt-5">
	        {% include 'pagination.html' %}
        </div>
    </div>


{% endblock content %}

{% block javascript %}

    <script type="text/javascript">
        {% for storageitem in storageitem_list %}
            let get_table_{{ storageitem.pk }} = document.querySelector('#table{{ storageitem.pk }}');
            get_table_{{ storageitem.pk }}.onclick = function() {
                location.href = '{% url "stock:storage_detail" storageitem.pk %}';
            }
        {% endfor %}


        $(function() {
            $('#baseSelect').change(function() {
                let val = $(this).val();
                let categorySelect = $('#categorySelect').val();
                {% for storageitem in storageitem_list %}
                    let base_{{ storageitem.pk }} = document.querySelector('#base{{ storageitem.pk }}');
                    let base_val_{{ storageitem.pk }} = base_{{ storageitem.pk }}.textContent;
                    let category{{ storageitem.pk }} = document.querySelector('#category{{ storageitem.pk }}');
                    let category_val{{ storageitem.pk }} = category{{ storageitem.pk }}.textContent;
                    if (categorySelect === category_val{{ storageitem.pk }}) {
                       if (val === base_val_{{ storageitem.pk }}) {
                            $('#table{{ storageitem.pk }}').show();
                        } else if (val === 'all') {
                            $('#table{{ storageitem.pk }}').show();
                        } else {
                            $('#table{{ storageitem.pk }}').hide();
                        }
                    } else if (categorySelect === 'all'){
                        if (val === base_val_{{ storageitem.pk }}) {
                            $('#table{{ storageitem.pk }}').show();
                        } else if (val === 'all') {
                            $('#table{{ storageitem.pk }}').show();
                        } else {
                            $('#table{{ storageitem.pk }}').hide();
                        }
                    } else {
                        $('#table{{ storageitem.pk }}').hide();
                    }
                {% endfor %}
            });
        });

        $(function() {
            $('#categorySelect').change(function() {
                let val = $(this).val();
                let baseSelect = $('#baseSelect').val();
                {% for storageitem in storageitem_list %}
                    let category{{ storageitem.pk }} = document.querySelector('#category{{ storageitem.pk }}');
                    let category_val{{ storageitem.pk }} = category{{ storageitem.pk }}.textContent;
                    let base_{{ storageitem.pk }} = document.querySelector('#base{{ storageitem.pk }}');
                    let base_val_{{ storageitem.pk }} = base_{{ storageitem.pk }}.textContent;
                    if (baseSelect === base_val_{{ storageitem.pk }}) {
                        if (val === category_val{{ storageitem.pk }}) {
                            $('#table{{ storageitem.pk }}').show();
                        } else if(val === 'all') {
                            $('#table{{ storageitem.pk }}').show();
                        }else {
                            $('#table{{ storageitem.pk }}').hide();
                        }
                    } else if (baseSelect === 'all') {
                        if (val === category_val{{ storageitem.pk }}) {
                            $('#table{{ storageitem.pk }}').show();
                        } else if(val === 'all') {
                            $('#table{{ storageitem.pk }}').show();
                        }else {
                            $('#table{{ storageitem.pk }}').hide();
                        }
                    } else {
                        $('#table{{ storageitem.pk }}').hide();
                    }
                {% endfor %}
            });
        });

    </script>

{% endblock javascript %}